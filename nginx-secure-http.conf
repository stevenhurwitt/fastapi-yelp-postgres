# Nginx configuration for security-hardened HTTP
# This restricts port 80 to only essential functions

server {
    listen 80;
    server_name 192.168.0.9 localhost raspberrypi;
    
    # Security: Immediately drop non-essential requests
    # Block common attack patterns on port 80
    location ~* \.(php|asp|aspx|jsp|cgi|pl|py|sh|exe|dll|bat|cmd)$ {
        return 444;  # Close connection without response
    }
    
    location ~ /\.(ht|env|git|svn) {
        return 444;
    }
    
    location ~ /(admin|administrator|wp-admin|wp-login|login|phpmyadmin|mysql|sql|db|database|backup|config) {
        return 444;
    }
    
    # Allow Let's Encrypt challenges (required for certificate renewal)
    location /.well-known/acme-challenge/ {
        root /var/www/html;
        try_files $uri =404;
        access_log off;
        log_not_found off;
    }
    
    # Security headers even for HTTP
    add_header X-Frame-Options DENY always;
    add_header X-Content-Type-Options nosniff always;
    add_header X-XSS-Protection "1; mode=block" always;
    
    # Redirect all other HTTP traffic to HTTPS
    location / {
        return 301 https://$server_name$request_uri;
    }
}