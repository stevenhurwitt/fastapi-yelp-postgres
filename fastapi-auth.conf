# FastAPI authentication failures and suspicious activity
# /etc/fail2ban/filter.d/fastapi-auth.conf

[Definition]
# Detect failed authentication attempts and suspicious API access
failregex = ^<HOST> - - \[.*\] "(GET|POST|PUT|DELETE) /api/.* HTTP/.*" (401|403|422) .*$
            ^<HOST> - - \[.*\] "(GET|POST|PUT|DELETE) .* HTTP/.*" 401 .*$
            ^<HOST> - - \[.*\] ".*" (400|403|404|422|429|500) .*".*bot.*".*$

# Ignore legitimate access
ignoreregex = ^<HOST> - - \[.*\] "(GET|POST|PUT|DELETE) /api/.* HTTP/.*" (200|201|204|301|302|304) .*$